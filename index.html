<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>DSF Studio Pro - Ultimate Edition</title>
    <link rel="stylesheet" href="css/main.css">
</head>

<body>

    <div id="sidebar">

        <div style="padding:8px 10px; border-bottom:1px solid #eee;">
            <label style="font-size:11px;">サイズ:</label>
            <div class="thumb-size-buttons">
                <button class="btn-sm" onclick="setThumbSize('S')">S</button>
                <button class="btn-sm" onclick="setThumbSize('M')">M</button>
                <button class="btn-sm" onclick="setThumbSize('L')">L</button>
            </div>
        </div>
        <div id="thumb-container"></div>
        <div style="padding:10px;"><button class="btn" onclick="addSection()">+ セクション追加</button></div>
    </div>

    <div id="editor-main">
        <!-- ツールバー -->
        <div class="toolbar">
            <button id="btn-undo" class="btn-tool" onclick="performUndo()" title="元に戻す (Ctrl+Z)" disabled>↩</button>
            <button id="btn-redo" class="btn-tool" onclick="performRedo()" title="やり直す (Ctrl+Shift+Z)"
                disabled>↪</button>
            <div class="divider"></div>
            <div class="project-controls">
                <button class="btn-tool" onclick="openProjectModal()" title="プロジェクト一覧">📂</button>
                <button class="btn-tool" onclick="newProject()" title="新規プロジェクト">📄</button>
                <span id="project-title" class="project-title" contenteditable="true" oninput="onProjectTitleInput()"
                    onkeydown="onProjectTitleKeydown(event)" onblur="onProjectTitleBlur()">新規プロジェクト</span>
                <button id="btn-save" class="btn-tool" onclick="saveProject()" title="保存">💾</button>
            </div>
            <span id="save-status" class="save-status"></span>
            <div class="divider"></div>
            <div id="lang-tabs" class="lang-tabs"></div>
        </div>
        <!-- キャンバス -->
        <div id="canvas-view" onmousedown="handleCanvasClick(event)">
            <div id="content-render"></div>
            <div id="bubble-layer"></div>
        </div>
    </div>

    <div id="panel-right">
        <div class="control-group">
            <h4>セクション設定</h4>
            <label>タイプ</label>
            <select id="prop-type" onchange="update('type', this.value)" style="width:100%; margin-bottom:10px;">
                <option value="image">イメージセクション</option>
                <option value="text">テキストセクション</option>
            </select>

            <div id="image-only-props">
                <label>背景画像アップロード</label>
                <input type="file" accept="image/*" onchange="uploadToStorage(this)">
            </div>

            <label>文字の向き</label>
            <select id="prop-mode" onchange="update('writingMode', this.value)" style="width:100%; margin-bottom:10px;">
                <option value="horizontal-tb">横書き</option>
                <option value="vertical-rl">縦書き</option>
            </select>

            <div id="bubble-shape-props">
                <label>吹き出し形状</label>
                <select id="prop-shape" onchange="updateBubbleShape(this.value)"
                    style="width:100%; margin-bottom:10px;">
                    <option value="speech">💬 通常</option>
                    <option value="thought">💭 考え中</option>
                    <option value="shout">💥 叫び</option>
                </select>
            </div>

            <label id="text-label">テキスト入力 (選択中の吹き出し or 背景テキスト)</label>
            <textarea id="prop-text" rows="5" style="width:100%;" oninput="updateActiveText(this.value)"></textarea>

            <button class="btn" style="margin-top:10px; background:#ff3b30; color:#fff;"
                onclick="deleteActive()">削除</button>
        </div>

        <div class="control-group">
            <h4>言語設定</h4>
            <div id="lang-list"></div>
            <div style="display:flex; gap:6px; margin-top:8px;">
                <select id="lang-add-select" style="flex:1;">
                    <option value="en">English</option>
                    <option value="ja">日本語</option>
                </select>
                <button class="btn-sm" onclick="addLang()">＋追加</button>
            </div>
        </div>


    </div>

    <!-- プロジェクト一覧モーダル -->
    <div id="project-modal">
        <div class="modal-overlay" onclick="closeProjectModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>📂 プロジェクト一覧</h2>
                <div class="modal-header-actions">
                    <button class="btn-modal primary" onclick="newProject()">＋ 新規プロジェクト</button>
                    <button class="btn-modal" onclick="closeProjectModal()">閉じる</button>
                </div>
            </div>
            <div class="modal-body">
                <div id="project-grid"></div>
            </div>
        </div>
    </div>

    <script type="module" src="js/app.js"></script>
</body>

</html>